<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>무한 스크롤 카카오 도서 검색</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
</head>

<body>

    <input type="text" id="book_search">
    <button id="search">검색</button>

    <p></p>


    <script>
        //무한 스크롤 
        let pageNum = 1;

        $("#search").click(function () {
            $("p").html("");

            $.ajax({
                method: "GET",
                url: "https://dapi.kakao.com/v3/search/book?target=title",
                data: {
                    query: $("#book_search").val(),
                    page: pageNum
                },
                headers: {
                    Authorization: "KakaoAK f993f7c41ef0998b0d68923a7eaedb6b"
                }

            })
                .done(function (msg) {
                    console.log(msg);
                    for (let i = 0; i < 10; i++) {
                        $("p").append("<h2><a href='" + msg.documents[i].url + "'>" + msg.documents[i].title + "</a></h2>");
                        $("p").append("<strong>저자:</strong> " + msg.documents[i].authors + "<br>");
                        $("p").append("<strong>출판사:</strong> " + msg.documents[i].publisher + "<br>");
                        $("p").append("<strong>요약:</strong> " + msg.documents[i].contents + "...<br>");
                        $("p").append("<img src='" + msg.documents[i].thumbnail + "'>");
                    }
                });
        })

        $(window).scroll(function () {

            if (Math.ceil($(window).scrollTop()) + $(window).height() >= $(document).height()) {
                pageNum++;


                $.ajax({
                    method: "GET",
                    url: "https://dapi.kakao.com/v3/search/book?target=title",
                    data: {
                        query: $("#book_search").val(),
                        page: pageNum
                    },
                    headers: {
                        Authorization: "KakaoAK 35df06b87c9a84e66f6530e11460b9a9"
                    }

                })
                    .done(function (msg) {
                        console.log(msg);
                        for (let i = 0; i < 10; i++) {
                            $("p").append("<h2><a href='" + msg.documents[i].url + "'>" + msg.documents[i].title + "</a></h2>");
                            $("p").append("<strong>저자:</strong> " + msg.documents[i].authors + "<br>");
                            $("p").append("<strong>출판사:</strong> " + msg.documents[i].publisher + "<br>");
                            $("p").append("<strong>요약:</strong> " + msg.documents[i].contents + "...<br>");
                            $("p").append("<img src='" + msg.documents[i].thumbnail + "'>");
                        }
                    });

            }

        });


    </script>
</body>

</html>